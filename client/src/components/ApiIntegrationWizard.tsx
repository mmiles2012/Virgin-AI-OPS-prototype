import { useState, useEffect } from 'react'; import { Card, CardContent, CardHeader, CardTitle } from './ui/card'; import { Button } from './ui/button'; import { CheckCircle, XCircle, Loader2, Settings, Globe, Plane, MapPin } from 'lucide-react'; interface ApiService { id: string; name: string; description: string; icon: React.ReactNode; status: 'connected' | 'disconnected' | 'testing' | 'error'; features: string[]; testEndpoint: string; connected: boolean; } interface TestResult { service: string; success: boolean; message: string; data?: any; } export default function ApiIntegrationWizard({ onClose }: { onClose: () => void }) { console.log('ApiIntegrationWizard component rendered'); const [currentStep, setCurrentStep] = useState(0); const [apiServices, setApiServices] = useState<ApiService[]>([ { id: 'aviationstack', name: 'AviationStack', description: 'Real-time flight tracking and airport data', icon: <Plane className="h-6 w-6" />, status: 'disconnected', features: ['Flight Status', 'Real-time Tracking', 'Airport Information', 'Flight Schedules'], testEndpoint: '/api/aviation/test-aviationstack', connected: false }, { id: 'opensky', name: 'OpenSky Network', description: 'Live aircraft positions and flight data', icon: <Globe className="h-6 w-6" />, status: 'disconnected', features: ['Live Aircraft Positions', 'Flight Trajectories', 'Aircraft Data', 'Global Coverage'], testEndpoint: '/api/aviation/test-opensky', connected: false }, { id: 'mapbox', name: 'Mapbox', description: 'High-quality satellite imagery and mapping', icon: <MapPin className="h-6 w-6" />, status: 'disconnected', features: ['Satellite Imagery', 'Vector Maps', 'Navigation', 'Geocoding'], testEndpoint: '/api/aviation/test-mapbox', connected: false } ]); const [testResults, setTestResults] = useState<TestResult[]>([]); const [isTestingAll, setIsTestingAll] = useState(false); const steps = [ { title: 'API Service Overview', description: 'Review available aviation data services and their capabilities' }, { title: 'Connection Testing', description: 'Test API connections and verify data access' }, { title: 'Integration Complete', description: 'Configure real-time data feeds and monitoring' } ]; const testApiConnection = async (service: ApiService) => { console.log('Testing API connection for:', service.name); setApiServices(prev => prev.map(s => s.id === service.id ? { ...s, status: 'testing' } : s )); try { console.log('Fetching:', service.testEndpoint); const response = await fetch(service.testEndpoint, { method: 'POST', headers: { 'Content-Type': 'application/json' } }); console.log('Response status:', response.status); const result = await response.json(); console.log('API test result:', result); const testResult: TestResult = { service: service.name, success: result.success, message: result.message, data: result.data }; setTestResults(prev => [...prev.filter(r => r.service !== service.name), testResult]); setApiServices(prev => prev.map(s => s.id === service.id ? { ...s, status: result.success ? 'connected' : 'error', connected: result.success } : s )); } catch (error) { const testResult: TestResult = { service: service.name, success: false, message: `Connection failed: ${error}` }; setTestResults(prev => [...prev.filter(r => r.service !== service.name), testResult]); setApiServices(prev => prev.map(s => s.id === service.id ? { ...s, status: 'error', connected: false } : s )); } }; const testAllConnections = async () => { setIsTestingAll(true); setTestResults([]); for (const service of apiServices) { await testApiConnection(service); // Small delay between tests await new Promise(resolve => setTimeout(resolve, 500)); } setIsTestingAll(false); }; const getStatusIcon = (status: string) => { switch (status) { case 'connected': return <CheckCircle className="h-5 w-5 text-green-500" />; case 'testing': return <Loader2 className="h-5 w-5 text-blue-500 animate-spin" />; case 'error': return <XCircle className="h-5 w-5 text-red-500" />; default: return <div className="h-5 w-5 rounded-full border-2 border-gray-400" />; } }; const renderStep = () => { switch (currentStep) { case 0: return ( <div className="space-y-6"> <div className="text-center mb-6"> <Settings className="h-12 w-12 text-blue-500 mx-auto mb-4" /> <h3 className="text-xl font-semibold text-gray-900 mb-2">Aviation API Services</h3> <p className="text-gray-300"> Connect to real-time aviation data sources for enhanced flight tracking and decision support </p> </div> <div className="grid gap-4"> {apiServices.map((service) => ( <Card key={service.id} className="bg-gray-800/50 border-gray-600"> <CardHeader className="pb-3"> <div className="flex items-center justify-between"> <div className="flex items-center gap-3"> <div className="text-blue-400">{service.icon}</div> <div> <CardTitle className="text-gray-900 text-lg">{service.name}</CardTitle> <p className="text-gray-400 text-sm">{service.description}</p> </div> </div> {getStatusIcon(service.status)} </div> </CardHeader> <CardContent> <div className="space-y-3"> <div> <h4 className="text-sm font-medium text-gray-300 mb-2">Features:</h4> <div className="flex flex-wrap gap-2"> {service.features.map((feature, index) => ( <span key={index} className="px-2 py-1 bg-blue-900/30 text-gray-700 rounded text-xs" > {feature} </span> ))} </div> </div> <button onClick={(e) => { e.preventDefault(); console.log('Test Connection button clicked for:', service.name); testApiConnection(service); }} disabled={service.status === 'testing'} className="w-full px-4 py-2 bg-blue-600 text-gray-900 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed" > {service.status === 'testing' ? ( <> <Loader2 className="h-4 w-4 mr-2 animate-spin inline" /> Testing Connection... </> ) : ( 'Test Connection' )} </button> </div> </CardContent> </Card> ))} </div> </div> ); case 1: return ( <div className="space-y-6"> <div className="text-center mb-6"> <Globe className="h-12 w-12 text-green-500 mx-auto mb-4" /> <h3 className="text-xl font-semibold text-gray-900 mb-2">Connection Testing</h3> <p className="text-gray-300"> Verify API connections and test data retrieval capabilities </p> </div> <div className="flex justify-center mb-6"> <button onClick={(e) => { e.preventDefault(); console.log('Test All Connections button clicked'); testAllConnections(); }} disabled={isTestingAll} className="px-6 py-3 bg-blue-600 text-gray-900 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed" > {isTestingAll ? ( <> <Loader2 className="h-4 w-4 mr-2 animate-spin inline" /> Testing All Services... </> ) : ( 'Test All Connections' )} </button> </div> <div className="space-y-4"> {testResults.map((result, index) => ( <Card key={index} className="bg-gray-800/50 border-gray-600"> <CardContent className="p-4"> <div className="flex items-center justify-between"> <div className="flex items-center gap-3"> {result.success ? ( <CheckCircle className="h-5 w-5 text-green-500" /> ) : ( <XCircle className="h-5 w-5 text-red-500" /> )} <div> <h4 className="font-medium text-gray-900">{result.service}</h4> <p className="text-sm text-gray-400">{result.message}</p> </div> </div> <span className={`px-2 py-1 rounded text-xs ${ result.success ? 'bg-green-900/30 text-green-600' : 'bg-red-900/30 text-red-300' }`} > {result.success ? 'Connected' : 'Failed'} </span> </div> {result.data && ( <div className="mt-3 p-3 bg-gray-500 rounded text-xs"> <pre className="text-gray-300 overflow-x-auto"> {JSON.stringify(result.data, null, 2)} </pre> </div> )} </CardContent> </Card> ))} </div> </div> ); case 2: const connectedServices = apiServices.filter(s => s.connected); return ( <div className="space-y-6"> <div className="text-center mb-6"> <CheckCircle className="h-12 w-12 text-green-500 mx-auto mb-4" /> <h3 className="text-xl font-semibold text-gray-900 mb-2">Integration Complete</h3> <p className="text-gray-300"> Successfully connected {connectedServices.length} of {apiServices.length} aviation data services </p> </div> <Card className="bg-green-900/20 border-green-600"> <CardContent className="p-6"> <h4 className="font-semibold text-green-600 mb-4">Active Services:</h4> <div className="space-y-3"> {connectedServices.map((service) => ( <div key={service.id} className="flex items-center gap-3"> <CheckCircle className="h-5 w-5 text-green-500" /> <div className="text-green-600">{service.icon}</div> <span className="text-gray-900">{service.name}</span> </div> ))} </div> </CardContent> </Card> <Card className="bg-blue-900/20 border-blue-600"> <CardContent className="p-6"> <h4 className="font-semibold text-gray-700 mb-4">Available Features:</h4> <div className="grid grid-cols-2 gap-3"> <div className="space-y-2"> <div className="flex items-center gap-2"> <CheckCircle className="h-4 w-4 text-green-500" /> <span className="text-sm text-gray-900">Real-time Flight Tracking</span> </div> <div className="flex items-center gap-2"> <CheckCircle className="h-4 w-4 text-green-500" /> <span className="text-sm text-gray-900">Live Aircraft Positions</span> </div> <div className="flex items-center gap-2"> <CheckCircle className="h-4 w-4 text-green-500" /> <span className="text-sm text-gray-900">Airport Information</span> </div> </div> <div className="space-y-2"> <div className="flex items-center gap-2"> <CheckCircle className="h-4 w-4 text-green-500" /> <span className="text-sm text-gray-900">Satellite Imagery</span> </div> <div className="flex items-center gap-2"> <CheckCircle className="h-4 w-4 text-green-500" /> <span className="text-sm text-gray-900">Flight Path Tracking</span> </div> <div className="flex items-center gap-2"> <CheckCircle className="h-4 w-4 text-green-500" /> <span className="text-sm text-gray-900">Emergency Notifications</span> </div> </div> </div> </CardContent> </Card> </div> ); default: return null; } }; return ( <div className="fixed inset-0 z-50 bg-black/80 shadow-sm flex items-center justify-center p-4"> <Card className="w-full max-w-4xl max-h-[90vh] overflow-y-auto bg-white border-gray-700"> <CardHeader className="border-b border-gray-700"> <div className="flex items-center justify-between"> <div> <CardTitle className="text-2xl text-gray-900">API Integration Wizard</CardTitle> <p className="text-gray-400 mt-1">{steps[currentStep].description}</p> </div> <button onClick={(e) => { e.preventDefault(); console.log('Close (X) button clicked'); onClose(); }} className="text-gray-400 hover:text-gray-900 p-1" > ✕ </button> </div> {/* Progress indicator */} <div className="flex items-center gap-2 mt-4"> {steps.map((step, index) => ( <div key={index} className="flex items-center"> <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${ index <= currentStep ? 'bg-blue-600 text-gray-900' : 'bg-gray-700 text-gray-400' }`} > {index + 1} </div> {index < steps.length - 1 && ( <div className={`w-12 h-0.5 ${ index < currentStep ? 'bg-blue-600' : 'bg-gray-700' }`} /> )} </div> ))} </div> </CardHeader> <CardContent className="p-6"> {renderStep()} </CardContent> <div className="border-t border-gray-700 p-6 flex justify-between"> <button onClick={(e) => { e.preventDefault(); console.log('Previous button clicked, currentStep:', currentStep); setCurrentStep(Math.max(0, currentStep - 1)); }} disabled={currentStep === 0} className="px-4 py-2 border border-gray-600 text-gray-300 rounded hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed" > Previous </button> {currentStep < steps.length - 1 ? ( <button onClick={(e) => { e.preventDefault(); console.log('Next button clicked, currentStep:', currentStep); setCurrentStep(Math.min(steps.length - 1, currentStep + 1)); }} className="px-4 py-2 bg-blue-600 text-gray-900 rounded hover:bg-blue-700" > Next </button> ) : ( <button onClick={(e) => { e.preventDefault(); console.log('Complete Integration button clicked'); onClose(); }} className="px-4 py-2 bg-green-600 text-gray-900 rounded hover:bg-green-700" > Complete Integration </button> )} </div> </Card> </div> ); }